/* AUTO-GENERATED FILE.  DO NOT MODIFY.
 *
 * This class was automatically generated by the
 * java mavlink generator tool. It should not be modified by hand.
 * è¿™ä¸ªç±»æ˜¯ç”±java mavlinkç”Ÿæˆå™¨å·¥å…·ã?å®ƒä¸åº”è¯¥è¢«æ‰‹åŠ¨ä¿®æ”¹ã?
 */

package com.MAVLink.Messages;

import com.MAVLink.MAVLinkPacket;

/**
 * Storage for MAVLink Packet and Error statistics
 * mavlinkåŒ…å’Œé”™è¯¯ç»Ÿè®¡å­˜å‚¨
 */
public class MAVLinkStats /* implements Serializable */ {

    public int receivedPacketCount;

    public int crcErrorCount;

    public int lostPacketCount;

    private int lastPacketSeq;

    /**
     * Check the new received packet to see if has lost someone between this and
     * the last packet
     * æ£?Ÿ¥æ–°çš„æ¥æ”¶çš„æ•°æ®åŒ…ï¼Œçœ‹çœ‹æ˜¯å¦å·²ç»å¤±å»äº†è¿™ä¹‹é—´çš„äººæœ€åä¸€ä¸ªåŒ…
     *
     * @param packet Packet that should be checked
     */
    public void newPacket(MAVLinkPacket packet) {
        advanceLastPacketSequence();
        if (hasLostPackets(packet)) {
            updateLostPacketCount(packet);
        }
        lastPacketSeq = packet.seq;
        receivedPacketCount++;
    }

    private void updateLostPacketCount(MAVLinkPacket packet) {
        int lostPackets;
        if (packet.seq - lastPacketSeq < 0) {
            lostPackets = (packet.seq - lastPacketSeq) + 255;
        } else {
            lostPackets = (packet.seq - lastPacketSeq);
        }
        lostPacketCount += lostPackets;
    }

    private boolean hasLostPackets(MAVLinkPacket packet) {
        return lastPacketSeq > 0 && packet.seq != lastPacketSeq;
    }

    private void advanceLastPacketSequence() {
        // wrap from 255 to 0 if necessary
        lastPacketSeq = (lastPacketSeq + 1) & 0xFF;
    }

    /**
     * Called when a CRC error happens on the parser
     */
    public void crcError() {
        crcErrorCount++;
    }

    /**
     * Resets statistics for this MAVLink.
     * é‡ç½®æ­¤mavlinkç»Ÿè®¡ã€?     */
    public void mavlinkResetStats() {
        lastPacketSeq = -1;
        lostPacketCount = 0;
        crcErrorCount = 0;
        receivedPacketCount = 0;
    }

}